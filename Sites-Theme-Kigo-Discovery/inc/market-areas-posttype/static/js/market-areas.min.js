function addslashes(a){return a.replace(/\\/g,"\\\\").replace(/\u0008/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/'/g,"\\'").replace(/"/g,'\\"')}function decodeHtmlEntity(a){return a.replace(/&#(\d+);/g,function(b,c){return String.fromCharCode(c)})}function encodeHtmlEntity(c){var a=[];if(typeof c==="undefined"){return""}for(var b=c.length-1;b>=0;b--){a.unshift(["&#",c[b].charCodeAt(),";"].join(""))}return a.join("")}function getItemsIn(b){var a=[];$.each(b.find("> *"),function(e,d){var f;if(typeof $(d).attr("data-name")==="undefined"){var g={id:$(d).attr("data-prop-id")};f=g}else{var c=$(d).attr("data-name");var h=$(d).attr("data-original-name");f={};f.originalName=h?h:c;f.name=c;f.contents=getItemsIn($(d).find("> ol"))}a.push(f)});return a}var updated=[];function update_ma_json(){var a=$(".user-list .to-save");updated=getItemsIn(a);$(hidden_selector).val(JSON.stringify(updated))}function setup_tree(h){var e="";for(var j in h){if(h[j].id){var b=encodeURIComponent(JSON.stringify(h[j]));var d=$('a[data-prop-id="'+h[j].id+'"]').html();var c=h[j].id;e+='<li class="prop-item active"  data-prop-id="'+c+'"><input type="checkbox"><a class="button button-property"  data-prop-id="'+c+'">'+decodeURIComponent(d)+"</a></li>"}else{if(h[j].originalName){var i=h[j].originalName;var a=h[j].name;var g=h[j].originalName.split("::")[1].trim();var f=setup_tree(h[j].contents);e+='<li class="ma-item active" data-name=\''+a+"' data-type=\""+g+'" data-original-name="'+i+"\"><a data-name='"+a+"' data-original-name=\""+i+'" class="button button-marketarea '+g+'">'+a+'</a><ol class="ma-list">'+f+"</ol></li>"}}}return e}function clear_areas(c){if(c){c.preventDefault()}var b=$(".user-list .to-save li.prop-item");$.each(b,function(e,d){$(".prop-list-parent").append($(d))});var a=$(".user-list .to-save li.ma-item");$.each(a,function(e,d){$(".ma-list-parent").append($(d))});remove_active_container();enable_quicksearches();update_ma_json()}function reset_areas(d){if(d){d.preventDefault()}clear_areas(d);var c=setup_tree(field_value);$(".user-list .to-save").append(c);var a=$(".user-list .to-save li.ma-item");$.each(a,function(g,f){var e=$(f).attr("data-original-name");$('.ma-list-parent li.ma-item[data-original-name="'+e+'"]').remove()});var b=$(".user-list .to-save li.prop-item");$.each(b,function(g,f){var e=$(f).attr("data-prop-id");$(f).addClass("old-value");$('.prop-list-parent li.prop-item[data-prop-id="'+e+'"]').insertAfter($(f));$(f).remove()});update_ma_json()}function enable_quicksearches(){var b=".ma-list-parent li";$("#search-locations").quicksearch(b);$("#search-locations-hidden").quicksearch(b);var a=".prop-list-parent li";$("#search-properties").quicksearch(a);$("#search-locations,#search-properties").on("search",function(c){$(this).keyup()})}function remove_active_container(){$(".active-container").removeClass("active-container")}(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var tree_watched=false;function countInArray(d,b){var c=0;for(var a=0;a<d.length;a++){if(d[a].trim().toLowerCase()===b.trim().toLowerCase()){c++}}return c}function tree_get_location_names(c){var d=new Array();for(var b in c){if(typeof c[b].name!=="undefined"){d.push(decodeHtmlEntity(c[b].name).trim().replace(/\s\s+/g," "));var a=tree_get_location_names(c[b].contents);d=d.concat(a)}}return d}function tree_set_alert(c,a){switch(a){case"name-repeated":var b="The name of this location appears more than one time in the tree. There cannot be more than one market areas with the same name. FIX THIS BEFORE SAVING! otherwise you will not be allowed to.";try{$.each(c,function(f,e){$(e).attr("data-animation",true).attr("data-toggle","tooltip").attr("data-placement","top").attr("data-original-title",b).addClass("name-repeated")});console.log(selector)}catch(d){}$('[data-toggle="tooltip"]').tooltip();break}}function tree_remove_alerts(){$(".name-repeated").removeClass("name-repeated");$('[data-toggle="tooltip"]').removeAttr("data-animation").removeAttr("data-toggle").removeAttr("data-placement").removeAttr("data-original-title").removeAttr("title")}function tree_validate(){if(tree_watched){var h=tree_get_location_names(updated);var g=new Array();var c=true;for(var e in h){var b=countInArray(h,h[e]);if(b>1){var d=h[e];var a='a[data-name="'+d+'"]';var f='a[data-name="'+encodeHtmlEntity(d)+'"]';$obj=$(a);if(!$obj.length){$obj=$(f)}tree_set_alert($obj,"name-repeated");c=false}}return c}return true}function watch_tree(){if(tree_watched){var a=tree_validate();if(a){tree_remove_alerts()}requestAnimationFrame(function(){watch_tree()})}else{tree_remove_alerts()}}function remove_all_edit_name(){$.each($(".market-areas-tree.to-save .button-marketarea"),function(b,a){$(this).html($(this).attr("data-name"))})}function modal(a){if(a.title){$(".modal-title").html(a.title)}else{$(".modal-title").html("")}if(a.body){$(".modal-body").html(a.body)}else{$(".modal-body").html("")}if(a.footer){$(".modal-footer").html(a.footer)}else{$(".modal-footer").html('<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>')}$("#page-modal").modal().on("hidden.bs.modal",function(b){$(".modal-body").html("")})}function get_subarea_form(b){var a="";a+='<h3>Select Template</h3><select class="subarea-template">'+$("select#market_area_use_landing_page_select").html()+"</select>";a+='<h3>Select pictures</h3><p>The first image will be set as Featured.</p><ul class="subarea-photo-list"></ul><input class="widefat subarea-photos" type="hidden" value="" /><a data-hidden=".subarea-photos" class="ma_upload_image_button button button-primary subarea-photo-pick">Pick images</a>';a+='<h3>Content:</h3><textarea class="subarea-content"></textarea>';return a}function saved_settings(){var a=$("input#subareas-conf").val();a=(a=="")?"{}":a;return JSON.parse(a)}function check_saved_settings(){var a=saved_settings();for(var b in a){$setting_button=$('[data-subarea="'+b+'"]');var c=0;if(a[b].name!=""){c++}if(a[b].images!="[]"){c++}if(a[b].template!=""){c++}if(a[b].content!=""){c++}if($setting_button.length){switch(c){case 4:$setting_button.removeClass("settings-partial");$setting_button.addClass("settings-filled");break;case 0:$setting_button.removeClass("settings-partial");$setting_button.removeClass("settings-filled");break;default:$setting_button.removeClass("settings-filled");$setting_button.addClass("settings-partial");break}}}}function modal_form(b){var d={title:"Configure Sub Area: "+b,body:get_subarea_form(),footer:'<button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary button-ok">OK</button>'};modal(d);var g=null;try{tinyMCE.init({selector:".subarea-content",setup:function(e){g=e;e.onChange.add(function(k,l){$(".subarea-content").val(k.getContent())});e.onKeyUp.add(function(k,l){$(".subarea-content").val(k.getContent())})}})}catch(i){$(".subarea-content").css("visibility","visible")}$(".subarea-photos").on("change",function(k){update_subarea_image_box()});$(".subarea-photo-list").sortable({placeholder:'<li class="img-box" height="100" width="100"><img class="placeholder-image" alt="Put Here" /></li>',onDrop:function(l,k,n,m){l.removeClass(k.group.options.draggedClass).removeAttr("style");$("body").removeClass(k.group.options.bodyClass);var e=$(".subarea-photo-list img");var o=new Array();$.each(e,function(q,p){o.push($(this).attr("src"))});$(".subarea-photos").val(JSON.stringify(o))}});$(".button-ok").on("click",function(r){var o=b;var n=$(".modal-body .subarea-template").val();var m=$(".modal-body .subarea-photos").val()==""?"[]":$(".modal-body .subarea-photos").val();var p=$(".modal-body .subarea-content").val();var k={name:b,template:n,images:m,content:p};var q=$("#subareas-conf").val()==""?"{}":$("#subareas-conf").val();var l=JSON.parse(q);l[b]=k;$("input#subareas-conf").val(JSON.stringify(l));$("#page-modal").modal("hide");check_saved_settings()});var a=$("#subareas-conf").val()==""?"{}":$("#subareas-conf").val();var c=JSON.parse(a);var f=c[b]?c[b].images:"[]";$(".subarea-photos").val(f);console.log(f);update_subarea_image_box(f);var j=c[b]?c[b].template:"";$(".modal-body .subarea-template").val(j);var h=c[b]?c[b].content:"";try{$(".modal-body .subarea-content").val(h);g.setContent(h)}catch(i){}}function add_subarea_form_fill_buttons(){if(tree_watched){$.each($(".to-save .button-marketarea"),function(c,b){var a=$(this).attr("data-name");$('<a class="button button-primary subarea-config" data-subarea="'+a+'"><i class="fa fa-wrench" aria-hidden="true"></i> Configure</a>').insertAfter($(this))})}}function modal_error_repeated_names(){modal({title:'<i class="fa fa-exclamation-triangle fa-3x" aria-hidden="true"></i>',body:'<h1>Error:</h1><p class="description">The Market areas tree has repeated names. <br /> Please fix this in order to save and create the landing pages.</p>',footer:'<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>'})}function update_subarea_image_box(a){var f=[];if(a){f=JSON.parse(a)}else{try{f=JSON.parse($(".subarea-photos").val())}catch(d){}}$(".subarea-photo-list").html("");for(d in f){var b=new Image();b.src=f[d];b.height=100;var c=document.createElement("li");c.className="img-box";c.appendChild(b);$(".subarea-photo-list").append(c)}}function update_setting_name(b,c){var d=saved_settings();var f=d[b];if(f){f.name=c;var e=f;d[c]=e;var a=JSON.stringify(d);$("input#subareas-conf").val(a)}}$(function(){$("ol.sortable").sortable({group:"sortable-group",placeholder:'<li class="placeholder">Drop Here</li>',isValidTarget:function(b,a){var c=$(a.el[0]);if(c.is(".ma-list-parent,.prop-list-parent, .to-save, .to-save > li > ol, .to-save > li > ol > li > ol,.to-save > li > ol > li > ol > li > ol, .to-save > li > ol > li > ol > li > ol > li > ol")){if(c.hasClass("ma-list-parent")&&b.hasClass("ma-item")){if(b.find(".prop-item").length){return false}return true}if(c.hasClass("prop-list-parent")&&b.hasClass("prop-item")){return true}if(c.is(".to-save, .to-save > li > ol, .to-save > li > ol > li > ol,.to-save > li > ol > li > ol > li > ol")&&b.is(".ma-item,.prop-item")){return true}if(c.is(".to-save > li > ol > li > ol,.to-save > li > ol > li > ol > li > ol, .to-save > li > ol > li > ol > li > ol > li > ol")&&b.is(".prop-item")){return true}}return false},onDrop:function(b,a,d,c){b.removeClass(a.group.options.draggedClass).removeAttr("style");$("body").removeClass(a.group.options.bodyClass);var e=$(a.el[0]);if(e.is(".to-save, .to-save > li > ol, .to-save > li > ol")&&b.is(".ma-item,.prop-item")){b.addClass("active");if(b.is(".ma-item")&&tree_watched){$(".subarea-config").remove();add_subarea_form_fill_buttons()}}else{b.removeClass("active");b.find(".subarea-config").remove()}enable_quicksearches();update_ma_json()}});$(document).on("dblclick",".market-areas-tree.to-save .button-marketarea",function(a){a.preventDefault();remove_all_edit_name();$(this).attr("data-old-name",$(this).text());$(this).html('<input type="text" class="edit-name" placeholder="'+$(this).attr("data-name")+'" value="'+$(this).attr("data-name")+'"/>').find(".edit-name").focus().select()}).on("keydown",".market-areas-tree.to-save .button-marketarea .edit-name",function(a){if(a.which==13){a.preventDefault();a.stopPropagation();if($(this).val()!==""){var b=$(this).val().trim().replace(/\s\s+/g," ");update_setting_name($(this).parent().attr("data-old-name"),b);$(this).parent().attr("data-name",b);$(this).parent().parent().attr("data-name",b);$(this).parent().html(b);update_ma_json();tree_remove_alerts();$(".subarea-config").remove();add_subarea_form_fill_buttons();check_saved_settings()}}if(a.which==27){$(this).parent().html($(this).parent().attr("data-name"))}}).on("click",function(a){remove_all_edit_name()});$("#search-locations, #search-properties").on("click",function(a){$(this).focus().select()});$(document).on("click",".button-marketarea",function(a){a.preventDefault();a.stopPropagation();remove_all_edit_name();if($(this).is(".to-save a")){remove_active_container();$(this).parent().find(">ol").addClass("active-container");$(this).addClass("active-container")}var b=$(this).attr("data-original-name").split("::")[0].trim();$("#search-properties").val(b).keyup()});$(".market-areas-tree").click(function(a){remove_active_container()});$(".add-selected").on("click",function(b){$(".select-visible").attr("checked",false);var a=$('.prop-list-parent li input[type="checkbox"]:checked');if($("ol.active-container").length){$.each(a,function(d,c){$(this).parent().appendTo("ol.active-container");$(this).attr("checked",false)})}else{$.each(a,function(d,c){$(this).parent().appendTo("ol.to-save");$(this).attr("checked",false)})}update_ma_json()});$(".generate-landings").on("click",function(b){var a=$(this).attr("checked")?true:false;switch(a){case true:tree_watched=true;$(".subarea-config").remove();add_subarea_form_fill_buttons();check_saved_settings();watch_tree();break;default:$(".subarea-config").remove();tree_watched=false}$("input#market_area_generate_landing").attr("checked",a)});$('[data-toggle="tooltip"]').tooltip();$(".generate-landings-label").hover(null,function(){$(this).find("input").blur()});enable_quicksearches();$(".button-property").on("click",function(a){$(this).prev().click()});$(".select-visible").on("change",function(b){var a=$(this).attr("checked")?true:false;$('.prop-list-parent li:visible input[type="checkbox"]').attr("checked",a)});$(".search-locations-select").on("change",function(a){if($(this).val()!==""){$(".ma-list-parent .ma-item").hide();$('.ma-list-parent [data-type="'+$(this).val()+'"]').show()}else{$(".ma-list-parent .ma-item").show()}});$('[name="save"]').on("click",function(a){a.preventDefault();if(tree_validate()){$("#post").submit()}else{modal_error_repeated_names()}});$(document).on("click",".subarea-config",function(a){if(!tree_validate()){modal_error_repeated_names()}else{modal_form($(this).attr("data-subarea"))}});$(".clear-areas").on("click",clear_areas);$(".reset-areas").on("click",reset_areas);reset_areas()});