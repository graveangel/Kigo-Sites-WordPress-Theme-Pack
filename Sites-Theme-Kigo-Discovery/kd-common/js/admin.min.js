function initSliders(){for(var e=document.querySelectorAll("#widgets-right .nouislider"),t=0;t<e.length;t++){var i=e.item(t);void 0!=i.noUiSlider&&i.noUiSlider.destroy(),noUiSlider.create(i,{start:JSON.parse(i.dataset.value),step:1,connect:"lower",range:{min:Number(i.dataset.min)||3,max:Number(i.dataset.max)||12},pips:{mode:"steps",density:100}}),i.noUiSlider.on("change",function(e){var t=document.getElementById(this.dataset.id);t.value=this.noUiSlider.get(),$(t).change()}.bind(i))}}function noUISliderToggle(){function e(){var e=document.querySelector('.nouislider[data-id="'+this.attributes["for"].value+'"]');e.classList.toggle("visible"),this.classList.toggle("active")}for(var t=document.querySelectorAll('#widgets-right label[data-type="size"]'),i=0;i<t.length;i++)t.item(i).onclick=e}function initMediaOverlay(){jQuery(document).on("click",".upload_button",function(e){e.preventDefault();var t=1==this.dataset.multiple,i=this.dataset.type||"image",n=1==t?this.dataset.name+"[]":this.dataset.name,a=this.parentElement.querySelector(".widget-media"),l=wp.media.frames.file_frame=wp.media({title:"Select or upload",library:{type:i},button:{text:"Select"},multiple:1==t});l.on("select",function(){var e=l.state().get("selection");e.each(function(e){var i=e.toJSON().url;if(!t&&null!==document.querySelector('input[name="'+n+'"]'))return document.querySelector('input[name="'+n+'"]').value=i,void(a.querySelector(".widget-media-item").style.backgroundImage="url("+i+")");var l=document.createElement("input"),s=document.createElement("div"),o=document.createElement("div");l.setAttribute("type","hidden"),l.setAttribute("name",n),l.value=i,s.setAttribute("style","background-image: url('"+i+"')"),s.classList.add("widget-media-item");var r=new Event("change",{bubbles:!0});o.classList.add("delete"),o.innerHTML="Delete",o.addEventListener("click",function(){this.parentElement.dispatchEvent(r),this.parentElement.remove()}),s.appendChild(l),s.appendChild(o),this.parentElement.querySelector(".widget-media").appendChild(s,this.parentElement.querySelector(".widget-media").firstChild),l.dispatchEvent(r)}.bind(this))}.bind(this)),l.open()})}function bindMediaItemEvents(){jQuery(".widget-media-item .delete").on("click",function(){this.parentElement.remove()})}function customSidebarsEvents(){var e=document.querySelector(".sidebar-generator #generator_button"),t=document.querySelector(".sidebar-generator #generator_input"),i=document.querySelector(".sidebars-container");if(e){e.addEventListener("click",function(){var e=t.value.trim();if(e.length>0){var n=document.createElement("div"),a=document.createElement("button"),l=document.createElement("input");l.type="text",l.name="custom_sidebars[]",l.value=e,a.classList.add("button","button-secondary"),a.type="button",a.innerText="Delete",a.addEventListener("click",function(){this.parentElement.remove()}),n.appendChild(l),n.appendChild(a),i.appendChild(n),t.value=""}});var n=document.querySelectorAll(".sidebars-container button");Array.prototype.forEach.call(n,function(e){e.addEventListener("click",function(){this.parentElement.remove()})})}}function addSidebarField(e,t,i){i||e.preventDefault();var n=document.createElement("li");n.className="sidebar-field-box sortable handle",n.style.padding="10px",n.style.backgroundColor="#fafafa",n.style.display="block";var a=document.createElement("label");a.style.display="block",a.className="handle";var l=document.createTextNode("Name:");a.appendChild(l),n.appendChild(a);var s=document.createElement("input");s.name="post-sidebar[name][]",s.type="text",s.style.display="block",s.value=t?t.value:"",n.appendChild(s);var o=document.createElement("label");o.style.display="block",o.className="handle";var r=document.createTextNode("Desktop Width:");o.appendChild(r),n.appendChild(o);var d=document.createElement("div");d.style.display="block",d.className="sidebar-width-box nouislider",n.appendChild(d);var c=document.createElement("input");c.name="post-sidebar[width][]",c.type="hidden",c.style.display="block",c.value=t?t.width:"",c.className="sidebar-width",n.appendChild(c);var u=document.createElement("label");u.style.display="block",u.className="handle";var r=document.createTextNode("Mobile Width:");u.appendChild(r),n.appendChild(u);var m=document.createElement("div");m.style.display="block",m.className="sidebar-width-mobile-box nouislider",n.appendChild(m);var p=document.createElement("input");p.name="post-sidebar[widthmob][]",p.type="hidden",p.style.display="block",p.value=t?t.widthmob:"",p.className="sidebar-width-mobile",n.appendChild(p);var h=document.createElement("a");txtnd=document.createTextNode("- Sidebar"),h.className="rem-sidebar",h.href="#",h.style.display="block",h.appendChild(txtnd),n.appendChild(h),sortable.destroy(),i?i.appendChild(n):e.target.parentNode.parentNode.appendChild(n);var v=d;noUiSlider.create(v,{start:c.value?c.value:100,step:10,margin:3,direction:"ltr",orientation:"horizontal",range:{min:0,max:100},pips:{mode:"steps",density:10}}),v.noUiSlider.on("update",function(e,t){c.value=e[t]});var f=m;noUiSlider.create(f,{start:p.value?p.value:100,step:10,margin:3,direction:"ltr",orientation:"horizontal",range:{min:0,max:100},pips:{mode:"steps",density:10}}),f.noUiSlider.on("update",function(e,t){p.value=e[t]});var g=document.getElementById("sortable");sortable=Sortable.create(g)}function debounce(e,t,i){var n;return function(){var a=this,l=arguments,s=function(){n=null,i||e.apply(a,l)},o=i&&!n;clearTimeout(n),n=setTimeout(s,t),o&&e.apply(a,l)}}function setFont(e){if(e.target.value){var t="#style_"+e.target.id,i="#preview_"+e.target.id,n="@import url(https://fonts.googleapis.com/css?family="+e.target.value.split(" ").join("+")+");";$(t).html(n),$(i).html(e.target.value).css("font-family",e.target.value)}}function setCookie(e,t,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var a="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+a}function getCookie(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}var kd_admin={init:function(){},loadInit:function(){try{this.initWidgetTabs(),this.initNoUISliders(),this.initMedia(),this.initCustomSidebarsPage(),this.initColorPickers(),this.initAceEditors(),this.initVirtualSidebars(),this.initIconPickers(),this.initSortables(),this.multiSelects(),this.multiSelectsCheckbox()}catch(e){console.log(e)}},DOMReadyInit:function(){this.addSidebarControls(),this.addWidgetControls(),this.openAllSidebars()},initNoUISliders:function(){initSliders(),noUISliderToggle()},initMedia:function(){initMediaOverlay(),bindMediaItemEvents()},initCustomSidebarsPage:function(){customSidebarsEvents()},initColorPickers:function(){if($.fn.wpColorPicker){var e=$("#widgets-right .colorPicker:not('.init')").wpColorPicker({border:"none",width:"100%",palettes:!1,mode:"hsl",change:debounce(function(){$(this).trigger("change")},250)});e.addClass("init")}},initCKEditors:function(){$("#widgets-right .kd_editor").ckeditor(debounce(function(){this.on("change",function(){var e=new Event("change",{bubbles:!0});this.updateElement(),this.element.$.dispatchEvent(e)})},1e3))},initAceEditor:function(){if(document.querySelectorAll("#custom_css").length){var e=ace.edit("custom_css"),t=document.querySelector("#custom_css_input");e.setTheme("ace/theme/monokai"),e.getSession().setMode("ace/mode/css"),e.resize(),document.querySelector(".kd-options form").addEventListener("submit",function(){t.value=e.getValue()})}},initAceEditors:function(){var e=document.querySelectorAll(".aceEditor");if(e.length)for(var t=0;t<e.length;t++){var i=ace.edit(e[t]),n=e[t].dataset.mode,a=document.querySelector("#"+e[t].dataset.input);i.setTheme("ace/theme/monokai"),i.getSession().setMode("ace/mode/"+n),i.myInput=a,i.on("change",function(){this.myInput.value=this.getSession().getValue()}.bind(i))}},initAceHtmlEditor:function(){try{var e=document.getElementsByClassName("editor-ace-html");for(var t in e){if("object"==typeof e[t]){var i=ace.edit(e[t].id),n=e[t].id;i.setTheme("ace/theme/monokai"),i.getSession().setMode("ace/mode/html");var a=$('textarea[name="'+n+'"]').hide(),l=a.attr("id");i.getSession().setValue(a.val()),i.getSession().on("change",function(){a.val(i.getSession().getValue()),wp.customize(l,function(e){e.set(i.getSession().getValue())})})}$(".go-fullscreen").on("click",function(e){e.preventDefault(),container=$(this).prev().toggleClass("editor-html-fullscreen"),$(".editor-ace-html").toggleClass("editor-html-fullscreen"),$(".ace_content").toggleClass("editor-html-fs")}),$(document).keyup(function(e){27==e.keyCode&&(container.toggleClass("editor-html-fullscreen"),$(".editor-ace-html").toggleClass("editor-html-fullscreen"),$(".ace_content").toggleClass("editor-html-fs"))})}}catch(t){}},initVirtualSidebars:function(){if(jQuery(".sortable").length){jQuery(".sidebar-add").live("click",function(e){addSidebarField(e)}),jQuery(".rem-sidebar").live("click",function(e){e.preventDefault(),jQuery(e.target).parent().remove()});var e=document.getElementById("sortable");sortable=Sortable.create(e),fields.forEach(function(t,i,n){addSidebarField(null,t,e)})}},initSortables:function(){$(".is_sortable").each(function(e,t){Sortable.create(t,{onUpdate:function(e){var t=new Event("change",{bubbles:!0});this.el.querySelector("input").dispatchEvent(t)}})})},initWidgetTabs:function(){var e=document.querySelectorAll(".widget-tabs");$.each(e,function(e,t){var i=t.querySelector(".tab-controls"),n=t.querySelector(".tab-contents");t.classList.add("tabs-initialized"),i.addEventListener("click",function(e){for(var t=e.target,a=0;null!==(t=t.previousElementSibling);a++);var l=i.querySelector(".active"),s=n.querySelector(".active"),o=i.children.item(a),r=n.children.item(a);l!==o&&(l.classList.remove("active"),s.classList.remove("active"),o.classList.add("active"),r.classList.add("active"))})})},addSidebarControls:function(){var e=document.querySelectorAll("body.wp-admin.widgets-php").length>0;if(e){var t=document.querySelector("#widgets-right");t.insertAdjacentHTML("afterbegin",'<ul class="sidebar-controls"><li data-filter="only-pages" class="active">Pages</li><li data-filter="only-header">Header</li><li data-filter="only-footer">Footer</li><li data-filter="only-side">Sidebars</li></ul>');for(var i=t.querySelectorAll(".sidebar-controls li"),n=0;n<i.length;n++){i.item(n);i.item(n).addEventListener("click",function(){if(this.dataset.filter){var e=t.querySelector(".sidebar-controls li.active")||!1;e&&e!==this&&(e.classList.remove("active"),this.classList.toggle("active"),t.className="",t.classList.add(this.dataset.filter))}})}}},addWidgetControls:function(){var e=document.querySelectorAll("body.wp-admin.widgets-php").length>0;if(e){var t=document.querySelector("#widgets-left"),i=t.querySelector("#widgets-left .sidebar-description"),n='<ul class="widgetLegend"><li data-type="default"><span>WordPress widget</span></li><li data-type="theme"><span>Theme widget</span></li><li data-type="kigo"><span>Kigo widget</span></li></ul>';i.insertAdjacentHTML("beforeend",n),$(".widgetLegend li").click(function(){var e=this.dataset.type;t.classList.toggle("filter_"+e),this.classList.toggle("active")})}},initIconPickers:function(){$(":not(#widgets-left) .iconPicker").iconpicker({placement:"top"}).on("iconpickerSetValue",function(e){e.iconpickerInstance.element[0].nextSibling.className="fa fa-"+e.iconpickerInstance.iconpickerValue})},openAllSidebars:function(){var e=document.querySelectorAll("#widgets-right .widgets-holder-wrap");$.each(e,function(e,t){t.classList.remove("closed")})},multiSelectsCheckbox:function(){$.each($('*[id*="kd_featured"] input[id*="userandom"]'),function(e,t){$(this).parent().find('input[id*="userandom"]').attr("checked")?($(this).parent().find(".multiselectjs").next().hide(),$(this).parent().find(".multiselectjs").prev().hide(),$(this).parent().find(".multiselectjs").prev().prev().hide()):($(this).parent().find(".multiselectjs").next().show(),$(this).parent().find(".multiselectjs").prev().show(),$(this).parent().find(".multiselectjs").prev().prev().show())})},multiSelects:function(){$(".multiselectjs").multiSelect({selectableHeader:"<div class='custom-header'><a href='#' class='kd-button filled multiselect-js-selectall'>Select All</a></div><br><input type='text' class='search-input' autocomplete='on' placeholder='Search within options'><br><br>",selectionHeader:"<div class='custom-header'><a href='#' class='kd-button filled multiselect-js-deselectall'>Deselect All</a></div><br><input type='text' class='search-input' autocomplete='on' placeholder='Search within selected'><br><br>",afterInit:function(e){var t=this,i=t.$selectableUl.prev().prev().prev(),n=t.$selectionUl.prev().prev().prev(),a="#"+t.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",l="#"+t.$container.attr("id")+" .ms-elem-selection.ms-selected";$(".multiselect-js-selectall").click(function(e){e.preventDefault(),t.select_all()}),$(".multiselect-js-deselectall").click(function(e){e.preventDefault(),t.deselect_all()}),t.qs1=i.quicksearch(a).on("keydown",function(e){if(40===e.which)return t.$selectableUl.focus(),!1}),t.qs2=n.quicksearch(l).on("keydown",function(e){if(40==e.which)return t.$selectionUl.focus(),!1})}}),$(document).on("click",'*[id*="kd_featured"] input[id*="userandom"]',function(e){$(this).attr("checked")?($(this).parent().find(".multiselectjs").next().hide(),$(this).parent().find(".multiselectjs").prev().hide(),$(this).parent().find(".multiselectjs").prev().prev().hide()):($(this).parent().find(".multiselectjs").next().show(),$(this).parent().find(".multiselectjs").prev().show(),$(this).parent().find(".multiselectjs").prev().prev().show())}),$(".multiselectjs").multiSelect("refresh")},maps:function(){function e(){$("#widgets-right .map-canvas.init").each(function(e,t){geocoder&&geocoder.geocode({address:t.dataset.location},function(e,i){var n=e[0].geometry.location,a=new google.maps.Map(t,{center:n,zoom:1*t.dataset.zoom||10});new google.maps.Marker({map:a,position:n});console.log(a,n),t.classList.remove("init")})})}if($("#widgets-right .map-canvas.init").length)if("undefined"==typeof google){var t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY7wxlnkMG6czYy9K-wM4OWXs0YFpFzEE",t.onload=function(){geocoder=new google.maps.Geocoder,e()},document.body.appendChild(t)}else e()}};window.addEventListener("load",kd_admin.loadInit.bind(kd_admin)),window.addEventListener("DOMContentLoaded",kd_admin.DOMReadyInit.bind(kd_admin)),kd_admin.init.bind(kd_admin);