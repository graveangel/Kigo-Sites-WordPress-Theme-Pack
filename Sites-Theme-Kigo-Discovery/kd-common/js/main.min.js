/* kd-main by j~: 08-06-2016*/
function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function getClassnameForCode(a){return 0>a||a>47?"wi-na":codeToClassname[a]}var app={debug:!0,modules:{widgets:{},templates:{}},bapiModules:{widgets:{},templates:{}},init:function(){this.initModules(this.modules),this.fixedHeader(),this.kdMove()},initBapi:function(){this.initModules(this.bapiModules)},initModules:function(a){for(var b in a)"function"==typeof a[b].init&&"function"==typeof a[b].cond?a[b].cond()&&(app.log("Initializing module",b,a[b]),a[b].init()):this.initModules(a[b])},initSwiper:function(a,b){return new Swiper(a,b)},fixedHeader:function(){function a(){var a=window.scrollY;a>=e?(c.classList.add("fixed"),b.style.paddingTop=d.clientHeight+"px"):(c.classList.remove("fixed"),b.style.paddingTop=0)}var b=document.querySelector("body"),c=document.querySelector(".header-background"),d=document.querySelector(".header-background .under_header"),e=c.clientHeight-d.clientHeight;window.addEventListener("scroll",debounce(a,10)),a()},exists:function(a){var b=document.querySelector(a);return b?!0:!1},isMobile:function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)},log:function(){this.debug&&console.log.apply(console,arguments)},bapiRender:function(a,b,c,d){var e={pagesize:20,seo:!0};BAPI.search(a,e,function(e){BAPI.get(e.result,a,{},function(a){var e={};e.result=a.result,e.config=BAPI.config();var f="object"==typeof d?Object.assign(e,d):e,g=Mustache.render(BAPI.UI.mustacheHelpers.getPartials(b),f);c(g)})})},bapi:{search:function(a,b,c){var d=c||{};BAPI.search(a,d,function(a){b(a)})},get:function(a,b,c,d){BAPI.get(b,a,_.assign(d,{}),function(a){c(a)})},recursiveGet:function(a,b,c){var d=c||{pagesize:20,waitForAll:!1};BAPI.search(a,d,function(c){var e=_.chunk(c.result,d.pagesize);if(1==d.waitForAll){var f=[],g=0;e.forEach(function(c,h){BAPI.get(c,a,d,function(a){g++,f=_.concat(f,a.result),g==e.length&&b({result:f,textdata:BAPI.textdata})})})}else e.forEach(function(c,e){BAPI.get(c,a,d,function(a){b(a)})})})},render:function(a,b){return Mustache.render(BAPI.UI.mustacheHelpers.getPartials(a),b)}},kdMove:function(){for(var a=document.querySelectorAll("[data-move]"),b=0;b<a.length;b++){var c=a[b],d=document.querySelector(c.dataset.move);d.appendChild(a[b]),c.classList.add("hasMoved")}}};window.addEventListener("load",app.init.bind(app)),window.addEventListener("DOMContentLoaded",app.initBapi.bind(app));var codeToClassname=["wi-tornado","wi-day-thunderstorm","wi-hurricane","wi-thunderstorm","wi-storm-showers","wi-rain-mix","wi-rain-mix","wi-rain-mix","wi-rain-mix","wi-snow","wi-rain-mix","wi-showers","wi-showers","wi-snow","wi-snow","wi-rain-mix","wi-snow","wi-rain-mix","wi-hail","wi-fog","wi-fog","wi-fog","wi-fog","wi-fog","wi-cloudy-gusts","wi-cloudy-gusts","wi-cloudy","wi-night-cloudy","wi-day-cloudy","wi-night-partly-cloudy","wi-day-cloudy","wi-night-clear","wi-day-sunny","wi-night-clear","wi-day-sunny","wi-rain-mix","wi-hot","wi-storm-showers","wi-storm-showers","wi-storm-showers","wi-showers","wi-snow","wi-showers","wi-rain-mix","wi-cloudy","wi-storm-showers","wi-hail","wi-storm-showers"];app.bapiModules.templates.propertyDetails={forceusemap:!1,mobileBreak:768,init:function(){this.cond()&&this.openCloseAmenitiesList().lightBoxAndCarousel().checkPropSettings().checkUseMap()},lightBoxAndCarousel:function(){var a=jQuery(".ppt-slides a").simpleLightbox();return jQuery(document).on("click",".more,.open-lightbox, .ppt-slides a",function(b){if(b.preventDefault(),"undefined"!=typeof jQuery(this).attr("data-index")){var c=jQuery(this).attr("data-index");a.open(jQuery(jQuery('.ppt-slides a[data-index="'+c+'"]')))}else a.open(jQuery(jQuery(".ppt-slides a")[0]))}),window.innerWidth<=768&&this.swiperCarousel(),this},swiperCarousel:function(){return"undefined"!=typeof SWCarousel&&SWCarousel||(SWCarousel=new Swiper(".ppt-images",{spaceBetween:0,nextButton:".next-slide",prevButton:".prev-slide",slidesPerView:1})),this},openCloseAmenitiesList:function(){return jQuery(document).on("click",".template-property .open-close",function(a){jQuery(this).parent().toggleClass("active")}),this},fixHeroImage:function(){if(app.exists(".hero-image")&&!app.isMobile()){var a=jQuery(".hero-image"),b=a.height(),c=a.parent(),d=c.height();if(b>d){var e=Math.round((b-d)/2);a.css("bottom","-"+e+"px")}}return this},checkUseMap:function(){function a(){var a={path:"M-0.5-41C-7.9-41-14-34.9-14-27.5c0,3,1.9,7.9,5.9,15c2.8,5,5.5,9.2,5.6,9.3l2,3l2-3c0.1-0.2,2.9-4.3,5.6-9.3c3.9-7.1,5.9-12,5.9-15C13-34.9,7-41-0.5-41z M-0.5-20.6c-3.9,0-7-3.1-7-7s3.1-7,7-7s7,3.1,7,7S3.4-20.6-0.5-20.6z",fillColor:k,fillOpacity:1,strokeColor:"rgba(0,0,0,.25)",strokeWeight:1};new google.maps.Marker({position:new google.maps.LatLng(e,f),map:j,iw:!1,icon:a})}function b(){var a=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:{lat:parseFloat(e),lng:parseFloat(f)},pov:{heading:34,pitch:10}});j.setStreetView(a)}function c(){jQuery(i).css("width","50%");var a=j.getCenter();google.maps.event.trigger(j,"resize"),j.setCenter(a),jQuery("#pano").css("width","50%").css("left","50%")}var d=parseInt(jQuery(".bapi-entityadvisor").attr("data-pkid")),e=jQuery(".bapi-entityadvisor").attr("data-lat"),f=jQuery(".bapi-entityadvisor").attr("data-long"),g=selected_usemap,h=!1;g.forEach(function(a){a===d&&(h=!0)}),/comingsoon\.gif/.test(jQuery(".bapi-entityadvisor").attr("data-bg"))&&(h=!0),this.forceusemap&&(h=!0);var i=document.querySelector(".hero-image");if(h){var j=new google.maps.Map(i,{center:{lat:parseFloat(e),lng:parseFloat(f)},scrollwheel:!1,zoom:18}),k=document.querySelector(".template-property[data-markercolor]").dataset.markercolor;switch(selected_usemap_layout){case 0:a(),jQuery(i).css("width","100%"),jQuery("#pano").hide();break;case 1:a(),b(),c();break;case 2:b(),jQuery(i).hide;break;default:a(),b(),c()}}else{var l=jQuery(".bapi-entityadvisor").attr("data-bg");jQuery(i).css("background-image",'url("'+l+'")')}return this},checkThumbs:function(){return/comingsoon\.gif/.test($(".simple-lightbox").attr("href"))?/comingsoon\.gif/.test(jQuery(".bapi-entityadvisor").attr("data-bg"))?($(".ppt-images").hide(),$(".ppt-desc").css("width","100%")):($(".ppt-images").show(),$(".simple-lightbox").attr("href",jQuery(".bapi-entityadvisor").attr("data-bg")),$(".thumb-img").attr("src",jQuery(".bapi-entityadvisor").attr("data-bg"))):($(".ppt-images").show(),1===$(".thumb-img").length&&($(".hero-image").css("background","transparent"),this.forceusemap=!0,$(".more").hide(),$(".ppt-slides li:first-child").css("width","100%"))),this},checkPropSettings:function(){return force_usemap&&(this.forceusemap=!0),forced_featured&&(this.forcedfeatured=!0),usemap_layout>=0&&force_usemap&&(selected_usemap_layout=usemap_layout),this},cond:function(){return app.exists(".page-template-property-detail")}},app.bapiModules.templates.searchPage={defaultView:"",templateSelector:"body.page-template-search-page",mapEle:document.querySelector("#mapContainer"),listInitted:!1,mapInitted:!1,mapPropContainer:document.querySelector("#mapPropertiesContainer"),listPropContainer:document.querySelector("#listPropertiesContainer"),properties:[],totalProps:0,mapObj:null,clustererObj:null,spiderfyObj:null,bounds:null,markers:[],propMarkers:{},openMarkers:[],currentViewMarkers:[],cond:function(){return document.querySelectorAll(this.templateSelector).length>0},init:function(){switch(this.viewToggle(),this.defaultView=BAPI.config().defaultsearchresultview,this.defaultView){case"tmpl-propertysearch-listview":this.doListView();break;case"tmpl-propertysearch-mapview":default:this.doMapView()}this.mapResetEvents()},getProperties:function(a,b){var c=20;this.properties.length?this.properties.forEach(function(b,c){a.call(this,b,c),this.updateCounters()}.bind(this)):app.bapi.search("property",function(d){var e=d.result,f=d.result.length;if(this.totalProps=f,this.updateCounters(),0==f)return void b.call(this,{},0);var g=_.chunk(e,c);g.forEach(function(b,d){app.bapi.get("property",b,function(b){b.result.forEach(function(b,c){this.properties=_.concat(this.properties,[b]),a.call(this,b,c),this.updateCounters()}.bind(this))}.bind(this),{pagesize:c,seo:!0})}.bind(this))}.bind(this),BAPI.session.searchparams)},updateCounters:function(){var a=this.properties.length,b=100*a/this.totalProps;$(".map .loader .bar").css("width",b+"%"),$(".ppty-count-current").text(a),$(".ppty-count-total").text(this.totalProps)},initMap:function(a,b){var c=BAPI.config().mapviewType,d=[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}];this.mapObj=new google.maps.Map(this.mapEle,{center:{lat:a,lng:b},zoom:8,styles:d,mapTypeId:google.maps.MapTypeId[c]})},initClusterer:function(){var a=[53,56,66,78,90],b=[{url:"/wp-content/themes/Sites-Theme-Kigo-Discovery/kd-common/img/markers/m1.png",height:a[0],width:a[0]},{url:"/wp-content/themes/Sites-Theme-Kigo-Discovery/kd-common/img/markers/m2.png",height:a[1],width:a[1]},{url:"/wp-content/themes/Sites-Theme-Kigo-Discovery/kd-common/img/markers/m3.png",height:a[2],width:a[2]},{url:"/wp-content/themes/Sites-Theme-Kigo-Discovery/kd-common/img/markers/m4.png",height:a[3],width:a[3]},{url:"/wp-content/themes/Sites-Theme-Kigo-Discovery/kd-common/img/markers/m5.png",height:a[4],width:a[4]}],c={gridSize:50,maxZoom:13,styles:b};this.clustererObj=new MarkerClusterer(this.mapObj,this.markers,c)},initSpiderfy:function(){this.spiderfyObj=new OverlappingMarkerSpiderfier(this.mapObj,{markersWontMove:!0,markersWontHide:!0,keepSpiderfied:!0,legWeight:2})},addMarker:function(a){var b=new google.maps.InfoWindow({content:'<div class="info-html prop-infowindow"><a href="'+a.ContextData.SEO.DetailURL+'" class="image" style="background-image: url('+a.PrimaryImage.ThumbnailURL+')"></a><div class="info"><h5 class="title">'+a.Headline+"</h5>"+a.Location+"</div></div>"}),c=new google.maps.Marker({position:new google.maps.LatLng(a.Latitude,a.Longitude),prop:a,map:this.mapObj,iw:b,icon:{path:"M-0.5-41C-7.9-41-14-34.9-14-27.5c0,3,1.9,7.9,5.9,15c2.8,5,5.5,9.2,5.6,9.3l2,3l2-3c0.1-0.2,2.9-4.3,5.6-9.3c3.9-7.1,5.9-12,5.9-15C13-34.9,7-41-0.5-41z M-0.5-20.6c-3.9,0-7-3.1-7-7s3.1-7,7-7s7,3.1,7,7S3.4-20.6-0.5-20.6z",fillColor:this.mapEle.dataset.color,fillOpacity:1,strokeWeight:0}});c.addListener("click",this.openMarker.bind(this,c)),this.clustererObj.addMarker(c),this.spiderfyObj.addMarker(c),this.spiderfyObj.addListener("click",function(a){this.openMarker(a)}.bind(this)),this.markers.push(c),this.propMarkers[a.AltID]=c},openMarker:function(a){this.openMarkers.map(function(a){a.iw.close()}),this.mapObj.setZoom(15);var b=new google.maps.LatLng({lat:a.getPosition().lat()+.004623495678337974,lng:a.getPosition().lng()});this.mapObj.panTo(b),_.delay(function(){a.iw.open(this.mapObj,a)}.bind(this),150),this.openMarkers.push(a)},addMapProps:function(a){var b=app.bapi.render("tmpl-propertysearch-mapview",{result:a,textdata:BAPI.textdata});this.mapPropContainer.innerHTML=b;var c=this.mapPropContainer.querySelectorAll("[data-altid]");_(c).forEach(function(a){var b=a.querySelector(".viewInMap"),c=a.dataset.altid;b.addEventListener("click",function(){var a=this.propMarkers[c];this.openMarker(a)}.bind(this))}.bind(this))},mapResetEvents:function(){var a=document.querySelectorAll(".resetMap");_.map(a,function(a){a.addEventListener("click",this.centerMap.bind(this))}.bind(this))},centerMap:function(){if(null==this.bounds){var a=new google.maps.LatLngBounds,b=this.markers;for(i in b){var c=b[i];a.extend(new google.maps.LatLng(c.position.lat(),c.position.lng()))}this.bounds=a,this.mapObj.fitBounds(this.bounds)}else this.mapObj.fitBounds(this.bounds)},mapBoundProps:function(){google.maps.event.addListener(this.mapObj,"dragstart",function(){this.mapPropContainer.classList.add("loading")}.bind(this)),google.maps.event.addListener(this.mapObj,"idle",function(){this.mapPropContainer.classList.remove("loading")}.bind(this)),google.maps.event.addListener(this.mapObj,"bounds_changed",_.debounce(function(){this.currentViewMarkers=[],this.markers.forEach(function(a){this.mapObj.getBounds().contains(a.getPosition())&&this.currentViewMarkers.push(a)}.bind(this));var a=[];this.currentViewMarkers.forEach(function(b){a.push(b.prop)}),this.addMapProps(a),$(".ppty-count-current").text(a.length)}.bind(this),250))},doMapView:function(){return document.querySelector(".listView").classList.add("hidden"),document.querySelector(".mapView").classList.remove("hidden"),this.mapInitted?void this.centerMap():void this.getProperties(function(a,b){0==this.markers.length&&(this.initMap(a.Latitude,a.Longitude),this.initClusterer(),this.initSpiderfy(),this.mapBoundProps()),this.addMarker(a),this.markers.length==this.totalProps&&(this.centerMap(),this.mapInitted=!0,_.map(document.querySelectorAll(".viewToggle button"),function(a){a.removeAttribute("disabled")}))},function(){this.addMapProps(this.properties)})},doListView:function(){document.querySelector(".mapView").classList.add("hidden"),document.querySelector(".listView").classList.remove("hidden"),this.listInitted||(this.getProperties(function(a,b){a.Summary=a.Summary.length<=200?a.Summary:a.Summary.replace(/(<([^>]+)>)/gi,"").substr(0,200)+'... <a href="'+a.ContextData.SEO.DetailURL+'">['+BAPI.textdata.more+"]</a>";var c=app.bapi.render("tmpl-propertysearch-listview",{result:[a],textdata:BAPI.textdata});this.listPropContainer.innerHTML+=c,this.properties.length==this.totalProps&&_.map(document.querySelectorAll(".viewToggle button"),function(a){a.removeAttribute("disabled")})},function(){var a=app.bapi.render("tmpl-propertysearch-listview",{result:[],textdata:BAPI.textdata});this.listPropContainer.innerHTML+=a}),this.listInitted=!0)},viewToggle:function(){document.querySelector(".viewToggle .v-map").addEventListener("click",this.doMapView.bind(this)),document.querySelector(".viewToggle .v-list").addEventListener("click",this.doListView.bind(this))}},app.bapiModules.widgets.buckets={selector:".kd-buckets",init:function(){$(this.selector).each(function(a,b){app.bapi.recursiveGet("searches",function(a){var c=Object.assign(a,{"class":b.dataset["class"]});b.innerHTML=app.bapi.render("tmpl-searches-quickview",c)})})},cond:function(){return app.exists(this.selector)}},app.modules.widgets.featured={selector:".kd-featured",sliderSelector:".swiper-container",observedSelector:".swiper-wrapper",init:function(){var a=document.querySelectorAll(this.selector);$.each(a,function(a,b){var c=b.querySelector(this.observedSelector);if(c.children.length>0)this.initSlider(a,b);else{var d=new MutationObserver(function(c){this.initSlider(a,b),d.disconnect()}.bind(this));d.observe(c,{childList:!0})}}.bind(this))},cond:function(){return app.exists(this.selector)},getSliderConfig:function(a){return{autoplay:!1,loop:!0,paginationClickable:!0,pagination:a.querySelector(".swiper-pagination"),nextButton:a.querySelector(".next"),prevButton:a.querySelector(".prev"),bulletActiveClass:"secondary-fill-color",simulateTouch:!1}},initSlider:function(a,b){var c=b.querySelector(this.sliderSelector);app.initSwiper(c,this.getSliderConfig(b))}},app.modules.widgets.hero={selector:".kd-hero",sliderSelector:".swiper-container",init:function(){var a=document.querySelectorAll(this.selector);$.each(a,this.initSlider.bind(this))},cond:function(){return app.exists(this.selector)},getSliderConfig:function(a){var b=a.querySelector(this.sliderSelector).dataset,c={autoplay:b.speed||!1,loop:"on"==b.loop,nextButton:a.querySelector(".next"),prevButton:a.querySelector(".prev"),effect:b.effect||"slide",speed:500,freeMode:"on"==b.freemode,direction:b.direction||"horizontal",pagination:"on"==b.pagination?a.querySelector(".swiper-pagination"):!1,paginationClickable:!0,bulletActiveClass:"active",centeredSlides:"on"==b.centered_slides,slidesPerView:b.slides_per_view||1};return c},initSlider:function(a,b){var c=this.getSliderConfig(b);app.initSwiper(b.querySelector(this.sliderSelector),c)}},app.modules.widgets.items={selector:".kd-items",init:function(){this.toggleEvents(),this.initSliders()},toggleEvents:function(){var a=document.querySelectorAll(".item-block .open-close");$.each(a,function(a,b){b.addEventListener("click",function(a){this.parentElement.classList.toggle("active")})})},initSliders:function(){for(var a=document.querySelectorAll(this.selector+" .swiper-container"),b=0;b<a.length;b++){var c=a[b];new Swiper(c,{spaceBetween:15,nextButton:".next-slide",prevButton:".prev-slide",slidesPerView:c.dataset.columns||5,loop:!0,loopAdditionalSlides:5,breakpoints:{992:{slidesPerView:3},780:{centeredSlides:!0,slidesPerView:2},480:{centeredSlides:!0,slidesPerView:1}}})}},cond:function(){return app.exists(".kd-items")}},app.modules.widgets.menu={selector:".kd-menu",init:function(){for(var a=document.querySelectorAll(this.selector),b=0;b<a.length;b++)this.bindEvents(a.item(b))},cond:function(){return app.exists(this.selector)},bindEvents:function(a){var b=a.querySelector(".toggle");b.addEventListener("click",this.toggleMenu.bind(a))},toggleMenu:function(){this.classList.toggle("active")}},app.bapiModules.widgets.search={selector:".kd-search",init:function(){$(this.selector).each(function(a,b){b.querySelector(".search-button-block .more").addEventListener("click",function(a){b.classList.toggle("open"),this.classList.toggle("active")})})},cond:function(){return app.exists(this.selector)}},app.bapiModules.widgets.selective_search={selector:".kd-selective-search-box",init:function(){$(".kd-selective-search-box .toggle-filter").on("click",function(a){a.preventDefault(),$(this).toggleClass("active");var b=$($(this).attr("data-types")),c=$(this).parent().parent().find(".toggle-filter"),d=$(this).prev();d.prop("checked",!d.prop("checked"));var e=[];$.each(c,function(a,b){$(this).hasClass("active")&&e.push($(this).attr("data-toggle"))}),b.get(0).value=e.join(",")}),$(".filter-by").on("click",function(a){a.preventDefault(),$(this).parent().on("click",function(a){a.stopPropagation()}),$(this).parent().next().toggleClass("active")}),$(".clearsearch").on("click",function(a){a.preventDefault(),$(".kd-selective-search-box .toggle-filter").removeClass("active");var b=$($(this).attr("data-types")),c=$(this).parent().parent().find(".ptype input");c.prop("checked",!1),b.get(0).value=""}),$(window).on("click",function(a){$(".currently-filtering").removeClass("active")}),$(".currently-filtering").on("click",function(a){a.stopPropagation()})},cond:function(){return app.exists(this.selector)}},app.bapiModules.widgets.specials={selector:".kd-specials",init:function(){$(this.selector).each(function(a,b){app.bapiRender("specials","tmpl-specials-quickview",function(a){b.innerHTML=a},{"class":b.dataset["class"]})})},cond:function(){return app.exists(this.selector)}},app.modules.widgets.team={mobileBreak:991,selector:".kd-team",init:function(){for(var a=document.querySelectorAll(this.selector+".swiper-container"),b=0;b<a.length;b++){var c=a[b];new Swiper(c,{nextButton:".next-slide",prevButton:".prev-slide",slidesPerView:c.dataset.columns||5,loop:!0,loopAdditionalSlides:5,simulateTouch:!1,breakpoints:{992:{slidesPerView:3},780:{centeredSlides:!0,slidesPerView:2},480:{centeredSlides:!0,slidesPerView:1}},onInit:function(){c.classList.remove("faded-out")}})}},cond:function(){return app.exists(".kd-team")}};